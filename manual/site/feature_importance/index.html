<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Workflow: Feature importance - LogMl</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Workflow: Feature importance";
    var mkdocs_page_input_path = "feature_importance.md";
    var mkdocs_page_url = "/feature_importance/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LogMl</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">LogMl</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">About</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cross_validation/">Cross-validation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../datasets/">Datasets</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../examples_custom_fucntions/">Learning by examples</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../explore/">Explore (df)</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Workflow: Feature importance</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#workflow-feature-importance">Workflow: Feature importance</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#model-based-column-permutation">Model-based column permutation</a></li>
        
            <li><a class="toctree-l3" href="#model-based-drop-column">Model-based drop-column</a></li>
        
            <li><a class="toctree-l3" href="#sklearn-importance">SkLearn importance</a></li>
        
            <li><a class="toctree-l3" href="#regularization-models">Regularization models</a></li>
        
            <li><a class="toctree-l3" href="#selection">Selection</a></li>
        
            <li><a class="toctree-l3" href="#recursive-feature-elimination">Recursive Feature Elimination</a></li>
        
            <li><a class="toctree-l3" href="#linear-model-p-value">Linear model p-value</a></li>
        
            <li><a class="toctree-l3" href="#logistic-regression-p-value">Logistic regression p-value</a></li>
        
            <li><a class="toctree-l3" href="#tree-graph">Tree graph</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#weighted-rank">Weighted rank</a></li>
    

    <li class="toctree-l2"><a href="#congig-yaml">Congig YAML</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../install/">Install</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../introduction/">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../introduction_cmd/">Introduction cmd</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../introduction_juppyter/">Introduction juppyter</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../logging/">Logging</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../model/">Model</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../model_hyperopt/">Model hyperopt</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../model_search/">Model search</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../overview/">Overview</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../workflow/">Workflow</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LogMl</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Workflow: Feature importance</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="workflow-feature-importance">Workflow: Feature importance</h1>
<p>Feature importance tries to detemine which</p>
<p>These steps implement data exploration when dataset is a DataFrame (i.e. <code>dataset_type: 'df'</code>).</p>
<h3 id="model-based-column-permutation">Model-based column permutation</h3>
<p>Estimate feature importance based on a model by randomly permuting values on each column.</p>
<p>How it works: Suffle a column and analyze how model performance is degraded. Most important features will make the model perform much worse when shuffled, unimportant features will not affect performance.</p>
<p>Models used (SciKit-Learn, default parameters):
- Random Forest
- ExtraTrees
- GradientBoosting</p>
<p><img alt="ExtraTrees drop column" src="../intro/logml_plots/dataset_feature_importance_dropcolumn.Feature_importance_permutation__all_ExtraTrees.png" /></p>
<h3 id="model-based-drop-column">Model-based drop-column</h3>
<p>Estimate feature importance based on a model by dropping a column.</p>
<p>How it works: Drops a single column, re-train and analyze how model performance
is degraded (respect to validation dataset). Most important features will
make the model perform much worse when dropped, unimportant features will
not affect performance</p>
<p>Models used (SciKit-Learn, default parameters):
- Random Forest
- ExtraTrees
- GradientBoosting</p>
<p><img alt="drop column" src="../intro/logml_plots/dataset_feature_importance_dropcolumn.Feature_importance_drop_column__all_RandomForest.png" /></p>
<h3 id="sklearn-importance">SkLearn importance</h3>
<p>Use default SciKit-Learn importance estimation method.
Models: Random Forest, ExtraTrees, GradientBoosting (default parameters)</p>
<h3 id="regularization-models">Regularization models</h3>
<p>Perform a model fir with regularization (using cross-validation), then analyze the model coefficients.</p>
<p>Models used (SciKit-Learn, default parameters):
- Lasso
- Ridge
- Lars (AIC)
- Lars (BIC)</p>
<p><img alt="regression models" src="../intro/logml_plots/dataset_feature_importance.Mean_square_error_per_fold__coordinate_descent.png" /></p>
<h3 id="selection">Selection</h3>
<p>Use a SciKit-Learn <code>SelectFdr</code> or <code>SelectKBest</code>, depending on whether the selection function has p-values or not.</p>
<table>
<thead>
<tr>
<th>Selection function</th>
<th>Has p-value</th>
<th>Classification / Regression</th>
</tr>
</thead>
<tbody>
<tr>
<td>f_regression</td>
<td>True</td>
<td>Regression</td>
</tr>
<tr>
<td>mutual_info_regression</td>
<td>False</td>
<td>Regression</td>
</tr>
<tr>
<td>f_classif</td>
<td>True</td>
<td>Classification</td>
</tr>
<tr>
<td>mutual_info_classif</td>
<td>False</td>
<td>Classification</td>
</tr>
<tr>
<td>chi^2</td>
<td>False</td>
<td>Classification</td>
</tr>
</tbody>
</table>
<h3 id="recursive-feature-elimination">Recursive Feature Elimination</h3>
<p>Use recursive feature elimination (SciKit-Learn <code>RFECV</code>) using several models:</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Classification / Regression</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lasso</td>
<td>Regression</td>
</tr>
<tr>
<td>Ridge</td>
<td>Regression</td>
</tr>
<tr>
<td>Lars (AIC)</td>
<td>Regression</td>
</tr>
<tr>
<td>Lars (BIC)</td>
<td>Regression</td>
</tr>
<tr>
<td>Random Forest</td>
<td>Classification, Regression</td>
</tr>
<tr>
<td>ExtraTrees</td>
<td>Classification, Regression</td>
</tr>
<tr>
<td>GradientBoosting</td>
<td>Classification, Regression</td>
</tr>
</tbody>
</table>
<p>In all cases, Scikit-Learn models with default parameters are used.</p>
<h3 id="linear-model-p-value">Linear model p-value</h3>
<p>Calculate p-value based on a linear model (<code>statsmodels.regression.linear_model.OLS</code>).
The null model variables can be set in the <em>config_YAML</em>, parameter <code>linear_pvalue_null_model_variables</code>.
P-values are corrected for multiple testing using False Discovery Rate (FDR).</p>
<h3 id="logistic-regression-p-value">Logistic regression p-value</h3>
<p>Calculate p-value based on a logistic regression model (Wilks theorem) (<code>statsmodels.discrete.discrete_model.Logit</code>).
The null model variables can be set in the <em>config_YAML</em>, parameter <code>logistic_regressions_by_class</code>
P-values are corrected for multiple testing using False Discovery Rate (FDR).</p>
<p>When the classification is non-binary (i.e. multiple classes), the p-values are calculated as one class compared to all others (for each class). Then p-values are FDR adjusted. Significance is assessed on any comparison.</p>
<h3 id="tree-graph">Tree graph</h3>
<p>Create a shallow decision tree (default <code>tree_graph_max_depth=4</code>) and show a graph og the tree</p>
<p><img alt="tree" src="../intro/intro.tree_graph_all.png" /></p>
<h1 id="weighted-rank">Weighted rank</h1>
<p>All feature importance algorithm results are combined in a summary table.</p>
<p>Finally the results are ranked according to all methods:</p>
<ul>
<li>Model based methods are weighted according to the 'loss functions' from each model (on the validation set), i.e. lower is better. Losses (lower is better) are transformed to weights (higher is better) and corrected to be in the range <code>[weight_min, weight_max]</code> (defalt <code>[1, 10]</code>)</li>
<li>Other methods use a weight of <code>weight_min</code> (default 1.0)</li>
<li>Ranks from all algorithms are multiplied by the weights to form a weighted rank sum (<code>rank_sum</code> in the summary table)</li>
<li>The <code>rank_sum</code> result is ranked, most important variables are shown first</li>
</ul>
<table>
<thead>
<tr>
<th>variable</th>
<th>importance_permutation_RandomForest</th>
<th>...</th>
<th>importance_dropcol_RandomForest</th>
<th>...</th>
<th>ranks_sum</th>
<th>rank_of_ranksum</th>
</tr>
</thead>
<tbody>
<tr>
<td>x1</td>
<td>73.424</td>
<td>...</td>
<td>50.154</td>
<td>...</td>
<td>134.99</td>
<td>1.0</td>
</tr>
<tr>
<td>x2</td>
<td>16.635</td>
<td>...</td>
<td>11.455</td>
<td>...</td>
<td>269.99</td>
<td>2.0</td>
</tr>
<tr>
<td>x3</td>
<td>2.723</td>
<td>...</td>
<td>1.856</td>
<td>...</td>
<td>404.98</td>
<td>3.0</td>
</tr>
</tbody>
</table>
<h1 id="congig-yaml">Congig YAML</h1>
<p>These are the <em>config_YAML</em> options related to feature importance</p>
<pre><code>dataset_feature_importance:
  # Set to 'false' to disable this step
  enable: true

  # Set to 'false' to disable this step for 'na' dataset (i.e. a dataset of missing data)
  enable_na: true

  # Enable &quot;Feature Importance using Permutations&quot; (for different models)
  is_fip_random_forest: true
  is_fip_extra_trees: true
  is_fip_gradient_boosting: true

  # Regularization methods
  # Enable regularization methods (for different models)
  is_regularization_lasso: true
  is_regularization_ridge: true
  is_regularization_lars: true
  # Number of Cross-validation in regularization methods
  regularization_model_cv: 10

  # Enable Recursive Feature Elimination (for different models)
  is_rfe_model: true
  is_rfe_model_lasso: true
  is_rfe_model_ridge: true
  is_rfe_model_lars_aic: true
  is_rfe_model_lars_bic: true
  is_rfe_model_random_forest: true
  is_rfe_model_extra_trees: true
  is_rfe_model_gradient_boosting: true
  rfe_model_cv: 0  # Number of Corss-validations in Recursive Feature Elimination methods

  # Enable model selection methods (SelectFdr / SelectKBest)
  is_select: true

  # Linear regression p-value
  is_linear_pvalue: true
  # Variables used for setting the null model (always add to linear regression model)
  linear_pvalue_null_model_variables: ['x6']

  # Tree graph
  is_tree_graph: true
  tree_graph_max_depth: 4  # Number of layers to show in graph

  # Range to use when expanding weights
  # Note: Weights are converted to an interval [weight_min, weight_max]
  weight_max: 10.0
  weight_min: 1.0

  # Logistic regression p-value (Wilks)
  is_wilks: true
  # Variables used for setting the null model
  wilks_null_model_variables: ['age', 'sex', 'pc_1', 'pc_2', 'pc_3', 'pc_4']

</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../install/" class="btn btn-neutral float-right" title="Install">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../explore/" class="btn btn-neutral" title="Explore (df)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../explore/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../install/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
